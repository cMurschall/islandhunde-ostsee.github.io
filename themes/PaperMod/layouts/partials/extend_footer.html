

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const charts = document.querySelectorAll(".pedigree-chart");
    if (charts.length === 0) return;

    let chartLibLoaded = false;

    // Create the IntersectionObserver
    const observer = new IntersectionObserver((entries, obs) => {
      entries.forEach(entry => {
        if (!entry.isIntersecting) return;

        const el = entry.target;
        const id = el.dataset.id;
        const file = el.dataset.file;

        const renderChart = () => {
          fetch(`/data/dogs/${file}.json`)
            .then(r => r.json())
            .then(data => renderDogPedigreeChart(id, data))
            .catch(err => console.error("Pedigree fetch failed:", err));
        };

        if (!chartLibLoaded) {
          chartLibLoaded = true;
          loadScript("{{ (resources.Get "js/dogPedigreeChart.js" | minify | fingerprint).RelPermalink }}")
            .then(() => renderChart())
            .catch(err => console.error("Chart library load failed:", err));
        } else {
          renderChart();
        }

        obs.unobserve(el); // Don't re-trigger
      });
    }, {
      rootMargin: "100px",
      threshold: 0
    });

    // Observe each chart container
    charts.forEach(el => observer.observe(el));

    // Helper to dynamically load script
    function loadScript(src) {
      return new Promise((resolve, reject) => {
        const s = document.createElement("script");
        s.src = src;
        s.defer = true;
        s.onload = resolve;
        s.onerror = () => reject(new Error("Failed to load: " + src));
        document.head.appendChild(s);
      });
    }
  });
</script>



{{ if eq hugo.Environment "development" }}
<script>
  console.log("ðŸš§ Hugo Debug Info:");
  console.log("Layout: {{ .Layout }}");
  console.log("Kind: {{ .Kind }}");
  console.log("Type: {{ .Type }}");
  console.log("Section: {{ .Section }}");
  {{ with .File }}
  console.log("Path: {{ .Path }}");
  {{ else }}
  console.log("Path: (no file - probably taxonomy or term page)");
  {{ end }}
</script>
{{ end }}